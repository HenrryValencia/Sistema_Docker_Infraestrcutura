[mysqld]

# --- Configuracion Basica y Logs ---
pid-file        = /var/run/mysqld/mysqld.pid
socket          = /var/run/mysqld/mysqld.sock
datadir         = /var/lib/mysql
secure-file-priv= NULL
bind-address    = 0.0.0.0
port            = 3306
# Use mysql_native_password for compatibility with some clients. Consider switching to caching_sha2_password.
default_authentication_plugin = mysql_native_password
#log_error = /var/log/mysql/error.log

# --- Configuracion de Replica Global (GTID) ---
gtid_mode = ON
enforce_gtid_consistency = ON
log_slave_updates = ON
log_bin = binlog
binlog_format = ROW
binlog_checksum = NONE
master_info_repository = TABLE
relay_log_info_repository = TABLE

# Improve group replication compatibility
transaction_write_set_extraction = XXHASH64

# --- Group Replication Configuration (Global) ---

plugin_load_add = 'group_replication.so'
group_replication_group_name = "aaaaaaaa-bbbb-cccc-dddd-eeeeffff0000"
group_replication_start_on_boot = OFF
group_replication_bootstrap_group = OFF
group_replication_exit_state_action = READ_ONLY
group_replication_flow_control_mode = "QUOTA"
group_replication_transaction_size_limit = 150000000
group_replication_ip_whitelist = "192.168.196.0/24,127.0.0.1/8,172.16.0.0/12"
group_replication_group_seeds = "192.168.196.151:33061,192.168.196.115:33061,192.168.196.245:33061"

# NOTES:
# - Keep group_replication_start_on_boot=OFF. We will bootstrap the cluster manually on the primary (node1).
# - Ensure ZeroTier is running on each host and that the container can reach the other nodes at the IPs above.
# - For production, review security and SSL settings for replication.

# --- VARIABLES LOCALES (DESCOMENTAR LA SECCION CORRESPONDIENTE EN CADA NODO) ---

# NODO 1 (macOS) - Bootstrap node
# Uncomment this block on node1 only
server_id = 1
auto_increment_increment = 3
auto_increment_offset = 1
report_host = 192.168.196.151
# group_replication_local_address = "192.168.196.151:33061"

# NODO 2 (Windows)
# Uncomment this block on node2 only
# server_id = 2
# auto_increment_increment = 3
# auto_increment_offset = 2
# report_host = 192.168.196.115
# group_replication_local_address = "192.168.196.115:33061"

# NODO 3 (Linux)
# Uncomment this block on node3 only
# server_id = 3
# auto_increment_increment = 3
# auto_increment_offset = 3
# report_host = 192.168.196.245
# group_replication_local_address = "192.168.196.245:33061"

# Important: after adjusting the node-specific block, restart the container so mysqld reads the correct server_id and report_host.